generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Nudgee {
  id                       String                     @id @default(uuid()) @db.Uuid
  nudge_category_model     Json?
  nudge_channel_model      Json?
  activity_model           Json?
  Activity                 Activity[]
  ActivityGoalContribution ActivityGoalContribution[]
  Nudge                    Nudge[]
  NudgeeGroup              NudgeeGroup[]

  @@map("nudgees")
}

model Nudge {
  id                     String          @id @default(uuid()) @db.Uuid
  text                   String          @db.Text @default("")
  nudgee_id              String          @db.Uuid
  activity_type_id       String          @db.Uuid
  timeframe_id           String          @db.Uuid
  configuration_id       String          @db.Uuid
  effectiveness          Int
  present_datetime       DateTime        @db.Timestamptz(6)
  reaction_wait_datetime DateTime        @db.Timestamptz(6)
  updated_at             DateTime        @updatedAt @db.Timestamptz(6)
  created_at             DateTime        @default(now()) @db.Timestamptz(6)
  ActivityType           ActivityType    @relation(fields: [activity_type_id], references: [id])
  Configuration          Configuration   @relation(fields: [configuration_id], references: [id])
  Nudgee                 Nudgee          @relation(fields: [nudgee_id], references: [id])
  Timeframe              Timeframe       @relation(fields: [timeframe_id], references: [id])
  UsedComponent          UsedComponent[]

  @@map("nudges")
}

model ActivityType {
  id                       String                     @id @default(uuid()) @db.Uuid
  name                     String
  Activity                 Activity[]
  ActivityGoalContribution ActivityGoalContribution[]
  Nudge                    Nudge[]

  @@map("activity_types")
}

model Activity {
  id               String       @id @default(uuid()) @db.Uuid
  nudgee_id        String       @db.Uuid
  activity_type_id String       @db.Uuid
  metadata         Json?
  datetime         DateTime     @db.Timestamptz(6)
  ActivityType     ActivityType @relation(fields: [activity_type_id], references: [id])
  Nudgee           Nudgee       @relation(fields: [nudgee_id], references: [id])

  @@map("activities")
}


model Timeframe {
  id         String   @id @default(uuid()) @db.Uuid
  name       String
  start_time DateTime @db.Time(6)
  end_time   DateTime @db.Time(6)
  Nudge      Nudge[]

  @@map("timeframes")
}

model ActivityGoalContribution {
  id               String       @id @default(uuid()) @db.Uuid
  nudgee_id        String       @db.Uuid
  activity_type_id String       @db.Uuid
  contribution     Int
  ActivityType     ActivityType @relation(fields: [activity_type_id], references: [id])
  Nudgee           Nudgee       @relation(fields: [nudgee_id], references: [id])

  @@map("activity_goal_contributions")
}

model Configuration {
  id                 String   @id @default(uuid()) @db.Uuid
  name               String
  algorithm          String
  reaction_wait_time Int
  start_time         DateTime @db.Timestamptz(6)
  Nudge              Nudge[]

  @@map("configurations")
}

model Group {
  id          String        @id @default(uuid()) @db.Uuid
  name        String
  NudgeeGroup NudgeeGroup[]

  @@map("groups")
}

model NudgeeGroup {
  nudgee_id String @db.Uuid
  group_id  String @db.Uuid
  Nudgee    Nudgee @relation(fields: [nudgee_id], references: [id])
  Group     Group  @relation(fields: [group_id], references: [id])

  @@id([nudgee_id, group_id])
  @@map("nudgee_groups")
}

model ComponentType {
  id             String           @id @default(uuid()) @db.Uuid
  label          String
  data_type      String
  ComponentValue ComponentValue[]

  @@map("component_types")
}

model ComponentValue {
  id                String          @id @default(uuid()) @db.Uuid
  component_type_id String          @db.Uuid
  value             String
  ComponentType     ComponentType   @relation(fields: [component_type_id], references: [id])
  UsedComponent     UsedComponent[]

  @@map("component_values")
}

model UsedComponent {
  nudge_id           String         @db.Uuid
  component_value_id String         @db.Uuid
  Nudge              Nudge          @relation(fields: [nudge_id], references: [id])
  ComponentValue     ComponentValue @relation(fields: [component_value_id], references: [id])

  @@id([nudge_id, component_value_id])
  @@map("used_components")
}
